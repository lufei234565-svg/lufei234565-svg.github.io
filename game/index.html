<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>代码探险岛 · 动画版 L1–L5</title>
<style>
  :root{
    --pri:#0d6efd; --bg:#f5f7fb; --panel:#fff; --border:#e5e7eb; --muted:#667085;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Microsoft YaHei",sans-serif;background:var(--bg);color:#111}
  header{background:var(--pri);color:#fff;padding:16px 20px;text-align:center}
  .wrap{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-columns:260px 1fr;gap:12px}
  .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px;height:calc(100vh - 140px);overflow:auto}
  .lvl{padding:10px 12px;border:1px solid var(--border);border-radius:10px;margin-bottom:8px;cursor:pointer;background:#fff}
  .lvl:hover{background:#f1f7ff}
  .active{outline:2px solid var(--pri)}
  .stage{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px;min-height:520px;display:flex;flex-direction:column}
  .topbar{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .btn{border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
  .btn.primary{background:var(--pri);border-color:var(--pri);color:#fff}
  .muted{color:var(--muted)}
  .scene{flex:1;border:1px dashed var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(#cde7ff22,#fff)}
  .footer{padding:16px;text-align:center}
  .footer a{color:var(--pri);text-decoration:none}
  .footer a:hover{text-decoration:underline}

  /* -------- L1 火把 -------- */
  .torch{position:relative;font-size:120px;filter:drop-shadow(0 6px 10px rgba(0,0,0,.25))}
  .torch .stick{font-size:.6em;position:absolute;left:50%;top:50%;transform:translate(-50%,-10%) rotate(25deg)}
  .flame{position:absolute;left:50%;top:12%;transform:translateX(-50%);font-size:.62em;opacity:.15;transition:.2s}
  .lit .flame{opacity:1;animation:flame .8s infinite ease-in-out alternate}
  @keyframes flame{from{transform:translateX(-50%) translateY(0) scale(1)} to{transform:translateX(-50%) translateY(-8px) scale(1.05)}}

  /* -------- L2 小球移动 -------- */
  .track{width:80%;height:10px;background:#e3e8ef;border-radius:999px;position:relative}
  .ball{position:absolute;left:0;top:50%;transform:translate(-50%,-50%);width:26px;height:26px;border-radius:50%;background:#0d6efd;box-shadow:0 4px 8px rgba(13,110,253,.35);transition:left .5s}

  /* -------- L3 开门 -------- */
  .gate{position:relative;width:360px;height:220px;background:#a5b4fc33;border:2px solid #94a3b8;border-radius:12px;display:flex;align-items:flex-end;justify-content:center;padding-bottom:16px;perspective:1000px}
  .door{width:120px;height:180px;background:#8b5e34;border:4px solid #6b4426;border-radius:8px;position:relative;transform-origin:left;transition:transform .7s}
  .door::after{content:"";position:absolute;right:12px;top:50%;width:10px;height:10px;border-radius:50%;background:#facc15}
  .door.open{transform:rotateY(-88deg)}
  .key{position:absolute;top:8px;right:8px;font-size:36px;opacity:.2}
  .key.have{opacity:1;animation:float 1.2s infinite ease-in-out alternate}
  @keyframes float{to{transform:translateY(-6px)}}

  /* -------- L4 喂小怪兽 -------- */
  .monster-area{position:relative;width:440px;height:240px}
  .monster{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:120px;height:120px;border-radius:50%;background:#22c55e;box-shadow:inset 0 -8px 0 rgba(0,0,0,.15)}
  .eye{position:absolute;top:32px;width:18px;height:18px;border-radius:50%;background:#111}
  .eye.left{left:36px}.eye.right{right:36px}
  .mouth{position:absolute;left:50%;bottom:28px;transform:translateX(-50%);width:60px;height:16px;border-radius:999px;background:#111}
  .food{position:absolute;left:30px;top:10px;font-size:40px;opacity:.2}
  .fed .food{opacity:1;animation:drop 1s ease forwards}
  @keyframes drop{to{transform:translate(180px,150px) scale(.6);opacity:0}}
  .speech{position:absolute;left:50%;bottom:-6px;transform:translate(-50%,100%);background:#fff;border:1px solid var(--border);border-radius:8px;padding:4px 8px;font-size:14px;opacity:0}
  .calm .speech{opacity:1}

  /* -------- L5 灯塔引航（网格移动） -------- */
  .grid{--cells:8; --size:48px; display:grid; grid-template-columns:repeat(var(--cells),var(--size)); grid-auto-rows:var(--size); gap:6px; background:#eef2ff; padding:10px;border-radius:12px;border:1px solid #c7d2fe}
  .cell{background:#ffffff;border:1px solid #e5e7eb;border-radius:8px}
  .boat{position:absolute;width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:28px solid #0ea5e9;transform:translate(-50%,-50%) rotate(0)}
  .course{position:relative}
  .tag{margin-top:10px;color:var(--muted)}
</style>
</head>
<body>
  <header><h1>🏝 代码探险岛 · 动画版 L1–L5</h1></header>

  <div class="wrap">
    <!-- 左侧关卡 -->
    <aside class="sidebar" id="menu"></aside>

    <!-- 舞台 -->
    <section class="stage">
      <div class="topbar">
        <button class="btn primary" id="run">▶ 运行</button>
        <button class="btn" id="reset">↩ 重置</button>
        <span class="muted" id="hint">请选择左侧关卡</span>
      </div>
      <div class="scene" id="scene"><!-- 动态填充 --></div>
      <div class="tag" id="desc"></div>
    </section>
  </div>

  <div class="footer">
    <a href="../">← 返回首页</a>
  </div>

<script>
/* ========== 关卡定义（动画版） ========== */
const LEVELS = {
  L1: {
    title:"L1 点亮火把 🔥",
    desc:"点击运行：火把被点亮（带火焰动画）。",
    setup(el){ // 初始场景
      el.innerHTML = `
        <div class="torch" id="torch">
          <div class="flame">🔥</div>
          <div class="stick">🪵</div>
        </div>`;
    },
    run(el){ el.querySelector("#torch").classList.add("lit"); },
    reset(el){ el.querySelector("#torch").classList.remove("lit"); }
  },

  L2: {
    title:"L2 移动小球 ⚽",
    desc:"点击运行：小球向右移动 10 步（可多次运行看到连贯移动）。",
    setup(el){
      el.innerHTML = `
        <div class="track" id="track">
          <div class="ball" id="ball"></div>
        </div>`;
      // 初始位置
      el.dataset.step = "0";
    },
    run(el){
      const steps = 10;
      const track = el.querySelector("#track");
      const ball  = el.querySelector("#ball");
      const max = track.clientWidth;
      // 每步位移（像素）
      let cur = +el.dataset.step;
      cur += steps;
      // 左偏移（百分比）
      const pos = Math.min(100, (cur/100)*100);
      ball.style.left = `${pos}%`;
      el.dataset.step = cur;
    },
    reset(el){
      el.dataset.step = "0";
      el.querySelector("#ball").style.left = "0%";
    }
  },

  L3: {
    title:"L3 开门试炼 🚪",
    desc:"点击运行：获得钥匙并打开大门（3D 旋转）。",
    setup(el){
      el.innerHTML = `
        <div class="gate">
          <div class="door" id="door"></div>
          <div class="key"  id="key">🗝️</div>
        </div>`;
    },
    run(el){
      el.querySelector("#key").classList.add("have");
      setTimeout(()=> el.querySelector("#door").classList.add("open"), 400);
    },
    reset(el){
      el.querySelector("#key").classList.remove("have");
      el.querySelector("#door").classList.remove("open");
    }
  },

  L4: {
    title:"L4 驯服小怪兽 🐾",
    desc:"点击运行：喂食并让小怪兽冷静下来（出现对话气泡）。",
    setup(el){
      el.innerHTML = `
        <div class="monster-area" id="area">
          <div class="monster">
            <div class="eye left"></div>
            <div class="eye right"></div>
            <div class="mouth"></div>
            <div class="speech">calm down…</div>
          </div>
          <div class="food" id="food">🍎</div>
        </div>`;
    },
    run(el){
      const area = el.querySelector("#area");
      area.classList.add("fed");
      setTimeout(()=> area.classList.add("calm"), 900);
    },
    reset(el){
      const area = el.querySelector("#area");
      area.classList.remove("fed","calm");
    }
  },

  L5: {
    title:"L5 灯塔引航 ⛵",
    desc:"路线：前进 5 格 → 右转 → 前进 3 格（网格上看到小船移动）。",
    setup(el){
      // 8x8 网格 + 船
      const cells = 8;
      const grid = document.createElement("div");
      grid.className = "grid";
      grid.style.setProperty("--cells", cells);
      const course = document.createElement("div");
      course.className = "course";
      for(let i=0;i<cells*cells;i++){
        const c = document.createElement("div");
        c.className="cell";
        grid.appendChild(c);
      }
      course.appendChild(grid);
      const boat = document.createElement("div");
      boat.id="boat"; boat.className="boat";
      course.appendChild(boat);
      el.innerHTML = ""; el.appendChild(course);

      // 起点（1,1）
      el.dataset.x = "1"; el.dataset.y = "1"; el.dataset.dir="right";
      positionBoat(el);
    },
    run(el){
      // 前进 5 → 右转 → 前进 3
      moveSteps(el,5, ()=>{ turnRight(el); moveSteps(el,3); });
    },
    reset(el){
      el.dataset.x="1"; el.dataset.y="1"; el.dataset.dir="right";
      positionBoat(el);
    }
  }
};

/* ========== 工具：L5 运动 ========== */
function positionBoat(scene){
  const boat = scene.querySelector("#boat");
  const grid = scene.querySelector(".grid");
  const size = parseInt(getComputedStyle(grid).getPropertyValue("--size")) || 48;
  const gap  = 6;
  const x = +scene.dataset.x, y = +scene.dataset.y;
  boat.style.left = (grid.offsetLeft + (x-1)*(size+gap) + size/2) + "px";
  boat.style.top  = (grid.offsetTop  + (y-1)*(size+gap) + size/2) + "px";

  const dir = scene.dataset.dir;
  const deg = dir==="right"?0:dir==="down"?90:dir==="left"?180:270;
  boat.style.transform = `translate(-50%,-50%) rotate(${deg}deg)`;
}
function turnRight(scene){
  const map = {right:"down", down:"left", left:"up", up:"right"};
  scene.dataset.dir = map[scene.dataset.dir] || "right";
  positionBoat(scene);
}
function stepForward(scene, cb){
  const dir = scene.dataset.dir;
  let x=+scene.dataset.x, y=+scene.dataset.y;
  if(dir==="right") x++; else if(dir==="down") y++; else if(dir==="left") x--; else y--;
  scene.dataset.x = String(Math.max(1,Math.min(8,x)));
  scene.dataset.y = String(Math.max(1,Math.min(8,y)));
  positionBoat(scene);
  setTimeout(()=>cb && cb(), 280);
}
function moveSteps(scene, n, after){
  let i=0; (function go(){ if(i++<n){ stepForward(scene, go); } else after && after(); })();
}

/* ========== 渲染与交互 ========== */
const menu = document.getElementById("menu");
const scene = document.getElementById("scene");
const desc  = document.getElementById("desc");
const hint  = document.getElementById("hint");
const runBtn= document.getElementById("run");
const rstBtn= document.getElementById("reset");

let current = null;

// 左侧菜单
Object.entries(LEVELS).forEach(([id, lv])=>{
  const d=document.createElement("div");
  d.className="lvl"; d.textContent=lv.title;
  d.onclick=()=>openLevel(id);
  d.id="btn-"+id;
  menu.appendChild(d);
});

function openLevel(id){
  current=id;
  [...menu.children].forEach(x=>x.classList.remove("active"));
  document.getElementById("btn-"+id).classList.add("active");
  hint.textContent = lv(id).title;
  desc.textContent = lv(id).desc;
  lv(id).setup(scene);
}

function lv(id){ return LEVELS[id]; }

runBtn.onclick = ()=>{ if(!current){hint.textContent="请先选择关卡"; return;} lv(current).run(scene); };
rstBtn.onclick = ()=>{ if(!current) return; lv(current).reset(scene); };

// 默认打开 L1
openLevel("L1");
</script>
</body>
</html>
