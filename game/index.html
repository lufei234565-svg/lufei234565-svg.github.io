<!DOCTYPE html>
<html lang="zh" data-theme="">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä»£ç æ¢é™©å²› Â· é«˜è´¨æ„Ÿ L1â€“L10</title>
<style>
  /* ä¸»é¢˜å˜é‡ */
  :root{
    --pri:#0d6efd; --pri-hover:#0b5ed7;
    --danger:#dc3545; --danger-hover:#bb2d3b;
    --bg:#f5f7fb; --panel:#fff; --border:#e5e7eb; --text:#111;
    --glow: color-mix(in srgb, var(--pri) 50%, transparent);
  }
  html[data-theme="green"]{
    --pri:#22c55e; --pri-hover:#16a34a; --danger:#ef4444; --danger-hover:#dc2626;
    --bg:#f0fdf4; --panel:#fff; --border:#d1fae5; --text:#0b0f10; --glow:#9ae6b4;
  }
  html[data-theme="blackgold"]{
    --pri:#d4af37; --pri-hover:#b8860b; --danger:#ff4d4f; --danger-hover:#d9363e;
    --bg:#0f0f0f; --panel:#151515; --border:#2a2a2a; --text:#f5f5f5; --glow:#e7c76a;
  }

  *{box-sizing:border-box}
  body{margin:0;font-family:"Microsoft YaHei",system-ui,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
  header{background:var(--pri);color:#fff;padding:16px;text-align:center;box-shadow:0 6px 16px color-mix(in srgb, var(--pri) 40%, transparent)}

  .topbar-fixed{
    position:fixed; top:12px; left:16px; right:16px; display:flex; justify-content:space-between; z-index:1000;
    pointer-events:none;
  }
  .top-left, .top-right{display:flex; gap:10px; pointer-events:auto}
  select{ padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--text); }

  .wrap{max-width:1200px;margin:0 auto;padding:12px;display:grid;grid-template-columns:280px 1fr;gap:12px}
  .sidebar{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px;height:calc(100vh - 170px);overflow:auto}
  .lvl{padding:12px;border:1px solid var(--border);border-radius:12px;margin-bottom:8px;background:var(--panel);cursor:pointer}
  .lvl:hover{background:color-mix(in srgb, var(--pri) 10%, var(--panel))}
  .active{outline:2px solid var(--pri)}
  .stage{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:14px 14px 18px;min-height:600px;display:flex;flex-direction:column}

  .controls{display:flex; gap:10px; margin-bottom:10px}
  .btn{
    border:1px solid var(--border); background:var(--pri); color:#fff;
    border-radius:999px; padding:10px 16px; font-size:14px; text-decoration:none; cursor:pointer;
    box-shadow:0 6px 16px color-mix(in srgb, var(--pri) 35%, transparent); transition:.2s;
  }
  .btn:hover{ background:var(--pri-hover) }
  .btn.danger{ background:var(--danger) }
  .btn.danger:hover{ background:var(--danger-hover) }

  .scene{
    flex:1; border:1px dashed var(--border); border-radius:14px; position:relative; overflow:hidden;
    display:flex; align-items:center; justify-content:center;
    background:
      radial-gradient(400px 180px at 70% 0%, #ffffff22, transparent 60%),
      linear-gradient(180deg, #a7f3ff1e, transparent 30%),
      var(--panel);
  }
  .desc{ margin-top:8px; color:#667085 }
  .result{ margin-top:8px; font-weight:700 }

  /* é€šå…³é—ªå…‰ */
  .spark{ position:absolute; inset:0; pointer-events:none; opacity:0; }
  .spark.show{ animation:shine .9s ease forwards }
  @keyframes shine{
    0%{ opacity:0 }
    30%{ opacity:1 }
    100%{ opacity:0 }
  }

  /* åœºæ™¯èƒŒæ™¯é¢„è®¾ */
  .bg-forest { background:linear-gradient(180deg,#dcfce7,#f0fdf4); }
  .bg-cave   { background:linear-gradient(180deg,#c7d2fe,#eef2ff); }
  .bg-temple { background:linear-gradient(180deg,#fde68a,#fff7ed); }
  .bg-sea    { background:linear-gradient(180deg,#bae6fd,#e0f2fe); }
  .bg-dark   { background:linear-gradient(180deg,#e5e7eb,#f3f4f6); }

  /* å°å…ƒç´  SVG å®¹å™¨ */
  .svg-wrap{ width:140px; height:140px; filter:drop-shadow(0 8px 16px rgba(0,0,0,.2)); }
  .gate{ width:220px; height:220px; }
  .dex{ width:360px; }

  @media (max-width:960px){ .wrap{grid-template-columns:1fr} .sidebar{height:auto} }
</style>
</head>
<body>

  <!-- å›ºå®šå·¥å…·æ¡ï¼šå·¦=ä¸»é¢˜ï¼Œå³=è¿”å›/é‡ç½® -->
  <div class="topbar-fixed">
    <div class="top-left">
      <label for="theme" style="align-self:center;background:color-mix(in srgb, var(--panel) 85%, transparent);padding:6px 10px;border:1px solid var(--border);border-radius:10px;">
        ğŸ¨ ä¸»é¢˜ï¼š
        <select id="theme">
          <option value="">è“è‰²</option>
          <option value="green">ç»¿è‰²</option>
          <option value="blackgold">é»‘é‡‘</option>
        </select>
      </label>
    </div>
    <div class="top-right">
      <a href="../" class="btn">ğŸ  è¿”å›é¦–é¡µ</a>
      <button id="resetProgress" class="btn danger">ğŸ”„ é‡æ–°å¼€å§‹</button>
    </div>
  </div>

  <header><h1>ä»£ç æ¢é™©å²› Â· é«˜è´¨æ„Ÿå…³å¡</h1></header>

  <div class="wrap">
    <aside class="sidebar" id="menu"></aside>

    <section class="stage">
      <div class="controls">
        <button class="btn" id="run">â–¶ è¿è¡Œ</button>
        <button class="btn" id="reset">â†© é‡ç½®</button>
        <span id="hint" style="margin-left:8px">è¯·é€‰æ‹©å·¦ä¾§å…³å¡</span>
      </div>

      <div class="scene" id="scene">
        <!-- åŠ¨æ€æ¸²æŸ“ -->
        <svg class="spark" id="spark" viewBox="0 0 200 200">
          <defs>
            <radialGradient id="sg" cx="50%" cy="50%" r="50%">
              <stop offset="0" stop-color="white" />
              <stop offset="1" stop-color="white" stop-opacity="0" />
            </radialGradient>
          </defs>
          <circle cx="100" cy="100" r="80" fill="url(#sg)" />
        </svg>
      </div>

      <div class="desc" id="desc"></div>
      <div class="result" id="result"></div>
      <button class="btn next-btn" id="nextBtn">â¡ ä¸‹ä¸€å…³</button>
    </section>
  </div>

  <div style="text-align:center;padding:12px;color:#777">
    Â© 2025 å¤§èƒ†ä¸“å±
  </div>

  <audio id="bgm" loop></audio>

<script>
/* ===== ä¸»é¢˜åŒæ­¥ ===== */
const themeSel = document.getElementById('theme');
const savedTheme = localStorage.getItem('siteTheme') || '';
document.documentElement.setAttribute('data-theme', savedTheme);
themeSel.value = savedTheme;
themeSel.onchange = () => {
  document.documentElement.setAttribute('data-theme', themeSel.value);
  localStorage.setItem('siteTheme', themeSel.value);
};

/* ===== å…¬å…±å¼•ç”¨ ===== */
const scene = document.getElementById('scene');
const desc  = document.getElementById('desc');
const hint  = document.getElementById('hint');
const result= document.getElementById('result');
const nextBtn=document.getElementById('nextBtn');
const bgm   = document.getElementById('bgm');
const spark = document.getElementById('spark');
let current=null;

function setResult(msg, ok=false){
  result.textContent = msg || '';
  nextBtn.classList.toggle('show', !!ok);
  if(ok){ spark.classList.remove('show'); void spark.offsetWidth; spark.classList.add('show'); }
}
function playMusic(url){ bgm.src=url; bgm.play().catch(()=>{}); }
function saveProgress(levelId){
  const n = Number(levelId.replace('L',''));
  const p = Number(localStorage.getItem('passedLevels')||0);
  localStorage.setItem('passedLevels', Math.max(p, n));
}

/* ===== å†…åµŒ SVG ç»„ä»¶ï¼ˆæ›´ç²¾è‡´ï¼‰ ===== */
const SVGs = {
  torch(lit=false){
    return `
    <svg class="svg-wrap" viewBox="0 0 120 120">
      <defs>
        <linearGradient id="wood" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="#a16207"/><stop offset="1" stop-color="#7c3f0e"/>
        </linearGradient>
        <radialGradient id="fire" cx="50%" cy="25%" r="40%">
          <stop offset="0" stop-color="#fff59d"/><stop offset="1" stop-color="#ef4444"/>
        </radialGradient>
      </defs>
      ${lit?`<circle cx="60" cy="28" r="18" fill="url(#fire)" opacity=".95">
        <animate attributeName="r" values="16;20;16" dur="1s" repeatCount="indefinite"/></circle>`:''}
      <rect x="52" y="30" width="16" height="70" rx="8" fill="url(#wood)"/>
      <circle cx="60" cy="28" r="12" fill="#fb923c" opacity="${lit?'.9':'.08'}"/>
    </svg>`;
  },
  door(open=false){
    return `
    <svg class="gate" viewBox="0 0 200 200">
      <rect x="10" y="20" width="180" height="160" rx="12" fill="#c7d2fe" stroke="#94a3b8" stroke-width="3"/>
      <g transform="${open?'rotate(-65 80 100)':'rotate(0 80 100)'}">
        <rect x="40" y="40" width="80" height="120" rx="10" fill="#8b5e34" stroke="#6b4426" stroke-width="6"/>
        <circle cx="108" cy="100" r="6" fill="#facc15"/>
      </g>
    </svg>`;
  },
  monster(calm=false){
    return `
    <svg class="svg-wrap" viewBox="0 0 120 120">
      <defs><linearGradient id="m" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#34d399"/><stop offset="1" stop-color="#10b981"/></linearGradient></defs>
      <circle cx="60" cy="60" r="42" fill="url(#m)" />
      <circle cx="45" cy="50" r="8" fill="#111"/>
      <circle cx="75" cy="50" r="8" fill="#111"/>
      <rect x="40" y="78" width="40" height="12" rx="6" fill="#111"/>
      ${calm?`<text x="60" y="110" font-size="14" text-anchor="middle" fill="#111">calm âœ“</text>`:''}
    </svg>`;
  },
  chest(open=false){
    return `
    <svg class="svg-wrap" viewBox="0 0 140 120">
      <rect x="20" y="40" width="100" height="60" rx="10" fill="#78350f" stroke="#5b290b" stroke-width="6"/>
      <rect x="20" y="20" width="100" height="30" rx="10" fill="#a16207"/>
      <rect x="65" y="20" width="10" height="80" fill="#fde047"/>
      <rect x="60" y="62" width="20" height="26" rx="4" fill="#fde047" stroke="#fbbf24" stroke-width="4"/>
      ${open?`<g opacity="1"><text x="70" y="38" text-anchor="middle">ğŸ’</text></g>`:`<g opacity=".05"><text x="70" y="38" text-anchor="middle">ğŸ’</text></g>`}
    </svg>`;
  },
  book(fill=false){
    return `
    <svg class="dex" viewBox="0 0 360 200">
      <rect x="10" y="10" width="340" height="180" rx="12" fill="#fff" stroke="#e5e7eb"/>
      <text x="60" y="70" font-size="42">ğŸ²</text>
      <text x="110" y="70" font-size="22" fill="#111">Dragon Â· Lv10</text>
      <rect x="110" y="110" width="210" height="12" rx="6" fill="#e5e7eb"/>
      <rect x="110" y="110" width="${fill?210:0}" height="12" rx="6" fill="#22c55e">
        ${fill?`<animate attributeName="width" from="0" to="210" dur=".8s" fill="freeze"/>`:''}
      </rect>
    </svg>`;
  }
};

/* ===== å…³å¡ï¼ˆé«˜è´¨æ„Ÿåœºæ™¯ï¼‰ ===== */
const LEVELS = {
  L1:{
    title:"L1 æ£®æ— Â· ç‚¹ç‡ƒç«æŠŠ", bg:"bg-forest",
    desc:"ç‚¹ç‡ƒç«æŠŠï¼Œç…§äº®å‰è·¯ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
    setup(el){ el.innerHTML = SVGs.torch(false); setResult(""); },
    run(el){ el.innerHTML = SVGs.torch(true); setResult("âœ… ç«æŠŠç‚¹äº®ï¼Œç»§ç»­å‰è¿›ï¼", true); saveProgress("L1"); }
  },
  L2:{
    title:"L2 æµ·å²¸ Â· å°çƒå¯èˆª", bg:"bg-sea",
    desc:"è®©å°çƒæŠµè¾¾ç¯å¡”ï¼ˆç‚¹å‡»è¿è¡Œå³å¯æ¼”ç¤ºåŠ¨ç”»ç‰ˆï¼‰ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
    setup(el){
      el.innerHTML = `<div style="width:80%;height:12px;background:#e3e8ef;border-radius:999px;position:relative">
        <div id="ball" style="position:absolute;left:0;top:50%;transform:translate(-50%,-50%);width:26px;height:26px;border-radius:50%;background:var(--pri);box-shadow:0 6px 14px var(--glow);transition:left .5s"></div>
      </div>`;
      el.dataset.pos=0; setResult("");
    },
    run(el){
      const ball = el.querySelector('#ball');
      let cur = +el.dataset.pos + 50; // ç™¾åˆ†æ¯”ä½ç§»
      cur = Math.min(cur, 100); ball.style.left = cur + "%"; el.dataset.pos = cur;
      if(cur>=100){ setResult("âœ… æŠµè¾¾ç¯å¡”ï¼", true); saveProgress("L2"); }
      else setResult("ç»§ç»­èˆªè¡Œä¸­â€¦");
    }
  },
  L3:{
    title:"L3 å±±å£ Â· æ‰“å¼€åŸé—¨", bg:"bg-cave",
    desc:"è·å¾—é’¥åŒ™å¹¶æ‰“å¼€åŸé—¨ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
    setup(el){ el.innerHTML = SVGs.door(false); setResult(""); },
    run(el){ el.innerHTML = SVGs.door(true); setResult("âœ… åŸé—¨æ•å¼€ï¼", true); saveProgress("L3"); }
  },
  L4:{
    title:"L4 æ—åœ° Â· å®‰æŠšæ€ªå…½", bg:"bg-forest",
    desc:"å–‚é£Ÿå°æ€ªï¼Œè§‚å¯Ÿå®ƒå†·é™ä¸‹æ¥ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
    setup(el){ el.innerHTML = SVGs.monster(false); setResult(""); },
    run(el){ el.innerHTML = SVGs.monster(true); setResult("âœ… æ€ªå…½å¹³é™ä¸‹æ¥ï¼", true); saveProgress("L4"); }
  },
  L5:{
    title:"L5 æµ·å³¡ Â· ç¯å¡”å¼•èˆª", bg:"bg-sea",
    desc:"æ¼”ç¤ºï¼šå‰è¿› 5 â†’ å³è½¬ â†’ å‰è¿› 3ï¼ˆç®€åŒ–æˆåˆ°è¾¾ç»ˆç‚¹ï¼‰ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",
    setup(el){ el.innerHTML = `<div style="width:90%;height:180px;border-radius:14px;border:1px dashed var(--border);position:relative;background:linear-gradient(180deg,#e0f2fe,#f0f9ff)">
      <div id="boat" style="position:absolute;left:14%;top:70%;width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:28px solid #0ea5e9;filter:drop-shadow(0 6px 12px rgba(0,0,0,.25));transition:all .35s"></div>
    </div>`; setResult(""); },
    run(el){
      const boat = el.querySelector('#boat');
      boat.style.left = '80%'; boat.style.top = '30%'; boat.style.transform = 'rotate(25deg)';
      setTimeout(()=>{ setResult("âœ… æŠµè¾¾èˆªç‚¹ï¼", true); saveProgress("L5"); }, 450);
    }
  },
  L6:{
    title:"L6 åœ°çªŸ Â· å®ç®±å¯†ç ", bg:"bg-cave",
    desc:"è¾“å…¥æ­£ç¡®å¯†ç  1234 æ‰“å¼€å®ç®±ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3",
    setup(el){ el.innerHTML = SVGs.chest(false); el.dataset.pass="1234"; setResult(""); },
    run(el){
      const i = prompt("è¯·è¾“å…¥å®ç®±å¯†ç ï¼ˆæç¤ºï¼š1234ï¼‰ï¼š",""); 
      if(i===el.dataset.pass){ el.innerHTML = SVGs.chest(true); setResult("âœ… å®ç®±å¼€å¯ï¼", true); saveProgress("L6"); }
      else setResult("âŒ å¯†ç é”™è¯¯ï¼Œå†è¯•è¯•ï½");
    }
  },
  L7:{
    title:"L7 ç¥åº™ Â· æ€ªå…½å›¾é‰´", bg:"bg-temple",
    desc:"å±•å¼€å›¾é‰´ï¼Œæ³¨æ»¡ HP æ¡ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3",
    setup(el){ el.innerHTML = SVGs.book(false); setResult(""); },
    run(el){ el.innerHTML = SVGs.book(true); setTimeout(()=>{ setResult("âœ… å›¾é‰´å®Œæˆï¼", true); saveProgress("L7"); }, 850); }
  },
  L8:{
    title:"L8 ç¥ç¢‘ Â· æ¿€æ´»æŒ‰é’®", bg:"bg-temple",
    desc:"æ¿€æ´»çŸ³ç¢‘ï¼ˆæŒ‰é’®é«˜äº®ï¼‰ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3",
    setup(el){
      el.innerHTML = `<div style="display:flex;flex-direction:column;align-items:center;gap:12px">
        <button id="b" class="btn" style="background:#e5e7eb;color:#111;border-color:#d1d5db">æŒ‰é’®</button>
        <small style="color:#6b7280">id=magicBtn</small>
      </div>`;
      setResult("");
    },
    run(el){ const b=el.querySelector('#b'); b.textContent='å·²æ¿€æ´»'; b.style.background='var(--pri)'; b.style.color='#fff'; setResult("âœ… çŸ³ç¢‘å·²æ¿€æ´»ï¼", true); saveProgress("L8"); }
  },
  L9:{
    title:"L9 å·è½´ Â· æ–½æ”¾æ³•æœ¯", bg:"bg-forest",
    desc:"ç‚¹å‡»é‡Šæ”¾ï¼Œæ˜¾ç¤º âœ¨ Spell Cast! åŠ¨æ•ˆã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3",
    setup(el){
      el.innerHTML = `<div style="position:relative;width:360px;padding:18px 22px;background:#fff7ed;border:1px solid #fed7aa;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06)">
        <div>å¤è€çš„å·è½´æ­£åœ¨ç­‰å¾…å’’è¯­â€¦</div>
        <button id="cast" class="btn" style="margin-top:10px">é‡Šæ”¾ï¼</button>
        <div id="fx" style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:32px;opacity:0;pointer-events:none">âœ¨ Spell Cast!</div>
      </div>`;
      el.querySelector('#cast').onclick = ()=>{
        const fx = el.querySelector('#fx'); fx.style.transition='none'; fx.style.opacity='0'; fx.style.transform='translate(-50%,-50%) scale(.6)';
        requestAnimationFrame(()=>{
          fx.style.transition='.6s'; fx.style.opacity='1'; fx.style.transform='translate(-50%,-50%) scale(1.2)';
          setTimeout(()=>{ fx.style.opacity='0'; }, 500);
        });
      };
      setResult("");
    },
    run(el){ el.querySelector('#cast').click(); setTimeout(()=>{ setResult("âœ… é­”æ³•é‡Šæ”¾æˆåŠŸï¼", true); saveProgress("L9"); }, 450); }
  },
  L10:{
    title:"L10 ç»ˆç«  Â· ç‹ä¹‹è¯•ç‚¼", bg:"bg-dark",
    desc:"ä¸‰åå®ˆå…³è€…ç°èº«ï¼ŒHP æ¡ä¾æ¬¡æ³¨æ»¡ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3",
    setup(el){
      el.innerHTML = `<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:min(680px,92%);">
        ${['ğŸŸ¢ Slime','ğŸ›¡ï¸ Orc','ğŸ² Dragon'].map(n=>`
          <div style="background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center">
            <div style="font-size:42px">${n.split(' ')[0]}</div>
            <strong>${n.split(' ')[1]}</strong>
            <div class="bar" style="height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:6px">
              <div class="v" style="height:100%;width:0;background:#ef4444"></div>
            </div>
          </div>`).join('')}
      </div>`;
      setResult("");
        L11:{
    title:"L11 å˜é‡ Â· ç‚¹äº®æ¬¡æ•°", bg:"bg-forest",
    desc:"æŠŠå˜é‡ count è®¾ä¸º 3ï¼Œç„¶åç‚¹äº®ç«æŠŠ 3 æ¬¡ã€‚å‘½ä»¤é¡ºåºï¼šset(\"count\",3) â†’ torch.on(count)",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
    setup(el){ el.innerHTML = SVGs.torch(false) + `<div id="counter" style="position:absolute;right:18px;top:18px;background:#fff7;border:1px solid var(--border);padding:6px 10px;border-radius:8px">count = <b id="cv">0</b></div>`; el.dataset.count=0; setResult(""); cmdHint.textContent='set("count",3) ç„¶å torch.on(count)'; },
    runDemo(el){ el.dataset.count=3; el.querySelector('#cv').textContent='3'; el.innerHTML = SVGs.torch(true) + el.querySelector('#counter').outerHTML; setResult("âœ… ç‚¹äº®å®Œæˆï¼",true); saveProgress("L11"); },
    commands:{
      'set("count",3)'(el){ el.dataset.count=3; el.querySelector('#cv').textContent='3'; setResult("å·²è®¾ç½® count=3"); },
      "set('count',3)"(el){ el.dataset.count=3; el.querySelector('#cv').textContent='3'; setResult("å·²è®¾ç½® count=3"); },
      'torch.on(count)'(el){ 
        if(+el.dataset.count===3){ this.runDemo(el); } 
        else setResult("âŒ å…ˆæ‰§è¡Œ set(\"count\",3) å† torch.on(count)");
      }
    }
  },

  L12:{
    title:"L12 å˜é‡è¿ç®— Â· æ‹¾å–é‡‘å¸", bg:"bg-temple",
    desc:"æ¯æ¬¡ add(\"coins\",10) å¢åŠ  10 é‡‘å¸ï¼Œç´¯ç§¯åˆ° 30 é€šå…³ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
    setup(el){ el.innerHTML = `<div style="text-align:center"><div class="svg-wrap">ğŸª™</div><h3>é‡‘å¸ï¼š<span id="coins">0</span></h3></div>`; el.dataset.coins=0; setResult(""); cmdHint.textContent='è¾“å…¥ 3 æ¬¡ï¼šadd("coins",10)'; },
    runDemo(el){ el.dataset.coins=30; el.querySelector('#coins').textContent='30'; setResult("âœ… é‡‘å¸è¾¾åˆ° 30ï¼",true); saveProgress("L12"); },
    commands:{
      'add("coins",10)'(el){ const c=+el.dataset.coins+10; el.dataset.coins=c; el.querySelector('#coins').textContent=c; if(c>=30){ setResult("âœ… é‡‘å¸è¾¾åˆ° 30ï¼",true); saveProgress("L12"); } else setResult(`å·²å¢åŠ ï¼Œå½“å‰ ${c}/30`); },
      "add('coins',10)"(el){ const c=+el.dataset.coins+10; el.dataset.coins=c; el.querySelector('#coins').textContent=c; if(c>=30){ setResult("âœ… é‡‘å¸è¾¾åˆ° 30ï¼",true); saveProgress("L12"); } else setResult(`å·²å¢åŠ ï¼Œå½“å‰ ${c}/30`); }
    }
  },

  L13:{
    title:"L13 æ¡ä»¶ Â· æ‹‰æ†å¼€é—¨", bg:"bg-cave",
    desc:"å…ˆæ‹‰ä¸‹æ‹‰æ† toggle(\"lever\")ï¼Œå†æ‰§è¡Œ openIf(\"lever\") æ‰“å¼€å¤§é—¨ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
    setup(el){ el.innerHTML = SVGs.door(false)+`<div style="position:absolute;left:18px;top:18px;background:#fff7;border:1px solid var(--border);padding:6px 10px;border-radius:8px">lever: <b id="lv">false</b></div>`; el.dataset.lever="false"; setResult(""); cmdHint.textContent='toggle("lever") â†’ openIf("lever")'; },
    runDemo(el){ el.dataset.lever="true"; el.querySelector('#lv').textContent='true'; el.innerHTML = SVGs.door(true) + el.querySelector('div').outerHTML; setResult("âœ… æ¡ä»¶æ»¡è¶³ï¼Œé—¨å·²å¼€ï¼",true); saveProgress("L13"); },
    commands:{
      'toggle("lever")'(el){ el.dataset.lever = (el.dataset.lever==="true"?"false":"true"); el.querySelector('#lv').textContent=el.dataset.lever; setResult(`lever = ${el.dataset.lever}`); },
      "toggle('lever')" (el){ el.dataset.lever = (el.dataset.lever==="true"?"false":"true"); el.querySelector('#lv').textContent=el.dataset.lever; setResult(`lever = ${el.dataset.lever}`); },
      'openIf("lever")'(el){ if(el.dataset.lever==="true"){ this.runDemo(el); } else setResult("âŒ lever è¿˜æ²¡æ‹‰ä¸‹"); },
      "openIf('lever')" (el){ if(el.dataset.lever==="true"){ this.runDemo(el); } else setResult("âŒ lever è¿˜æ²¡æ‹‰ä¸‹"); }
    }
  },

  L14:{
    title:"L14 æ¡ä»¶åˆ¤æ–­ Â· å¤§äºæ¯”è¾ƒ", bg:"bg-temple",
    desc:"è‹¥ x>3 åˆ™æ¿€æ´»çŸ³ç¢‘ã€‚å‘½ä»¤ï¼šset(\"x\",4) â†’ if(x>3) activate()",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
    setup(el){ el.innerHTML = `<div style="text-align:center"><button id="b" class="btn" style="background:#e5e7eb;color:#111;border-color:#d1d5db">æŒ‰é’®</button><div style="margin-top:8px">x = <b id="xv">0</b></div></div>`; el.dataset.x=0; setResult(""); cmdHint.textContent='set("x",4) â†’ if(x>3) activate()'; },
    runDemo(el){ const b=el.querySelector('#b'); b.textContent='å·²æ¿€æ´»'; b.style.background='var(--pri)'; b.style.color='#fff'; setResult("âœ… æ¡ä»¶ä¸ºçœŸï¼Œå·²æ¿€æ´»ï¼",true); saveProgress("L14"); },
    commands:{
      'set("x",4)'(el){ el.dataset.x=4; el.querySelector('#xv').textContent='4'; setResult("x å·²è®¾ä¸º 4"); },
      "set('x',4)"(el){ el.dataset.x=4; el.querySelector('#xv').textContent='4'; setResult("x å·²è®¾ä¸º 4"); },
      'if(x>3) activate()'(el){ if(+el.dataset.x>3){ this.runDemo(el); } else setResult("âŒ x ä¸å¤§äº 3"); }
    }
  },

  L15:{
    title:"L15 å¾ªç¯ Â· é‡å¤ç§»åŠ¨", bg:"bg-sea",
    desc:"ä½¿ç”¨ repeat(3){ move() } è®©èˆ¹ç§»åŠ¨ 3 æ¬¡åˆ°è¾¾ç»ˆç‚¹ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",
    setup(el){ 
      el.innerHTML = `<div style="width:92%;height:160px;border-radius:14px;border:1px dashed var(--border);position:relative;background:linear-gradient(180deg,#e0f2fe,#f0f9ff)"><div id="boat" style="position:absolute;left:10%;top:60%;width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:28px solid #0ea5e9;filter:drop-shadow(0 6px 12px rgba(0,0,0,.25));transition:all .3s"></div></div>`;
      el.dataset.step=0; setResult(""); cmdHint.textContent='repeat(3){ move() }';
    },
    runDemo(el){ const boat=el.querySelector('#boat'); boat.style.left='80%'; boat.style.top='40%'; setTimeout(()=>{ setResult("âœ… åˆ°è¾¾ï¼",true); saveProgress("L15"); }, 380); },
    commands:{
      'repeat(3){ move() }'(el){ 
        const boat=el.querySelector('#boat'); 
        let i=0; (function go(){ i++; boat.style.left=(10+i*20)+'%'; if(i<3) setTimeout(go,300); else setTimeout(()=>{ setResult("âœ… åˆ°è¾¾ï¼",true); saveProgress("L15"); },320); })();
      }
    }
  },

  L16:{
    title:"L16 å˜é‡ + å¾ªç¯", bg:"bg-forest",
    desc:"å…ˆè®¾ n=4ï¼Œå†æ‰§è¡Œ repeat(n){ step() }ï¼Œæ­¥æ•°è¾¾æ ‡é€šå…³ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3",
    setup(el){ el.innerHTML = `<div style="text-align:center"><div style="height:12px;width:80%;background:#e5e7eb;border-radius:999px;margin:0 auto;overflow:hidden"><div id="bar" style="height:100%;width:0;background:var(--pri);transition:width .25s"></div></div><div style="margin-top:8px">n = <b id="nv">0</b></div></div>`; el.dataset.n=0; el.dataset.k=0; setResult(""); cmdHint.textContent='set("n",4) â†’ repeat(n){ step() }'; },
    runDemo(el){ el.querySelector('#bar').style.width='100%'; setTimeout(()=>{ setResult("âœ… æ­¥æ•°è¾¾æ ‡ï¼",true); saveProgress("L16"); },320); },
    commands:{
      'set("n",4)'(el){ el.dataset.n=4; el.querySelector('#nv').textContent='4'; setResult("n=4"); },
      "set('n',4)"(el){ el.dataset.n=4; el.querySelector('#nv').textContent='4'; setResult("n=4"); },
      'repeat(n){ step() }'(el){ const n=+el.dataset.n; if(n!==4) return setResult("âŒ å…ˆæŠŠ n è®¾ä¸º 4"); const bar=el.querySelector('#bar'); let i=0; (function go(){ i++; bar.style.width=(i/n*100)+'%'; if(i<n) setTimeout(go,240); else setTimeout(()=>{ setResult("âœ… æ­¥æ•°è¾¾æ ‡ï¼",true); saveProgress("L16"); },260); })(); }
    }
  },

  L17:{
    title:"L17 æ•°ç»„ Â· æ”¶é›†å®çŸ³", bg:"bg-temple",
    desc:"ä½¿ç”¨ collect([\"ğŸ”´\",\"ğŸ”µ\",\"ğŸŸ¢\"]) ä¸€æ¬¡æ€§æ”¶é›† 3 é¢—å®çŸ³ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3",
    setup(el){ el.innerHTML = `<div style="text-align:center"><div id="bag" style="font-size:32px;letter-spacing:6px;min-height:40px"></div><div style="color:#6b7280">ç›®æ ‡ï¼šğŸ”´ ğŸ”µ ğŸŸ¢</div></div>`; setResult(""); cmdHint.textContent='collect(["ğŸ”´","ğŸ”µ","ğŸŸ¢"])'; },
    runDemo(el){ el.querySelector('#bag').textContent='ğŸ”´ ğŸ”µ ğŸŸ¢'; setResult("âœ… æ”¶é›†å®Œæˆï¼",true); saveProgress("L17"); },
    commands:{
      'collect(["ğŸ”´","ğŸ”µ","ğŸŸ¢"])'(el){ this.runDemo(el); },
      "collect(['ğŸ”´','ğŸ”µ','ğŸŸ¢'])"(el){ this.runDemo(el); }
    }
  },

  L18:{
    title:"L18 æ’åº Â· å¤è€å¯†ç ", bg:"bg-cave",
    desc:"æŠŠæ•°ç»„æ’åºï¼šsort([3,1,2])ï¼Œæ˜¾ç¤º 1,2,3 é€šå…³ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3",
    setup(el){ el.innerHTML = `<div style="text-align:center"><div>åŸå§‹ï¼š<b>3,1,2</b></div><div id="sorted" style="margin-top:8px;font-size:20px"></div></div>`; setResult(""); cmdHint.textContent='sort([3,1,2])'; },
    runDemo(el){ el.querySelector('#sorted').textContent='æ’åºç»“æœï¼š1,2,3'; setResult("âœ… æ’åºæ­£ç¡®ï¼",true); saveProgress("L18"); },
    commands:{ 'sort([3,1,2])'(el){ this.runDemo(el); } }
  },

  L19:{
    title:"L19 æ¡ä»¶åˆ†æ”¯ Â· æ‰¾é’¥åŒ™æˆ–å¼€é—¨", bg:"bg-forest",
    desc:"ä¸¤æ­¥ï¼šfindKey() â†’ open()ã€‚è‹¥æ²¡é’¥åŒ™åˆ™ä¸èƒ½å¼€é—¨ã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3",
    setup(el){ el.innerHTML = SVGs.door(false)+`<div style="position:absolute;right:18px;top:18px;background:#fff7;border:1px solid var(--border);padding:6px 10px;border-radius:8px">key: <b id="kv">false</b></div>`; el.dataset.key="false"; setResult(""); cmdHint.textContent='findKey() â†’ open()'; },
    runDemo(el){ el.dataset.key="true"; el.querySelector('#kv').textContent='true'; el.innerHTML = SVGs.door(true) + el.querySelector('div').outerHTML; setResult("âœ… å¼€é—¨æˆåŠŸï¼",true); saveProgress("L19"); },
    commands:{
      'findKey()'(el){ el.dataset.key="true"; el.querySelector('#kv').textContent='true'; setResult("ğŸ”‘ æ‰¾åˆ°é’¥åŒ™"); },
      'open()'(el){ if(el.dataset.key==="true"){ this.runDemo(el); } else setResult("âŒ è¿˜æ²¡æœ‰é’¥åŒ™ï¼Œå…ˆ findKey()"); }
    }
  },

  L20:{
    title:"L20 ç»ˆæ Â· å¾ªç¯æ”»å‡» Boss", bg:"bg-dark",
    desc:"ä½¿ç”¨ repeat(5){ attack() } è¿å‡» 5 æ¬¡å‡»è´¥ Bossã€‚",
    music:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3",
    setup(el){
      el.innerHTML = `<div style="text-align:center">
        <div style="font-size:48px">ğŸ‰ Boss</div>
        <div style="height:12px;width:80%;background:#e5e7eb;border-radius:999px;margin:8px auto;overflow:hidden">
          <div id="hp" style="height:100%;width:100%;background:#ef4444;transition:width .2s"></div>
        </div>
        <div>HPï¼š<b id="hpv">100</b></div>
      </div>`;
      el.dataset.hit=0; setResult(""); cmdHint.textContent='repeat(5){ attack() }';
    },
    runDemo(el){ const hp=el.querySelector('#hp'); const hpv=el.querySelector('#hpv'); let i=0; (function go(){ i++; const left=Math.max(0,100-i*20); hp.style.width=left+'%'; hpv.textContent=left; if(i<5) setTimeout(go,220); else setTimeout(()=>{ setResult('âœ… Boss å€’ä¸‹ï¼',true); saveProgress('L20'); },260); })(); },
    commands:{
      'repeat(5){ attack() }'(el){ this.runDemo(el); }
    }
  },

    },
    run(el){
      const bars=[...el.querySelectorAll('.v')];
      bars.forEach((b,i)=> setTimeout(()=> b.style.width='100%', i*320));
      setTimeout(()=>{ setResult('âœ… ç»ˆæè¯•ç‚¼å®Œæˆï¼', true); saveProgress('L10'); }, 1200);
    }
  }
};

/* ===== æ¸²æŸ“ & äº¤äº’ ===== */
const menu = document.getElementById('menu');
Object.entries(LEVELS).forEach(([id, lv])=>{
  const d = document.createElement('div');
  d.className='lvl'; d.id='btn-'+id; d.textContent=lv.title;
  d.onclick=()=>openLevel(id);
  menu.appendChild(d);
});

function openLevel(id){
  current=id;
  [...menu.children].forEach(x=>x.classList.remove('active'));
  document.getElementById('btn-'+id).classList.add('active');
  hint.textContent = LEVELS[id].title;
  desc.textContent = LEVELS[id].desc;
  scene.className = 'scene ' + (LEVELS[id].bg||'');
  LEVELS[id].setup(scene);
  playMusic(LEVELS[id].music);
  setResult('');
  nextBtn.classList.remove('show');
}

document.getElementById('run').onclick = ()=>{ if(current) LEVELS[current].run(scene); };
document.getElementById('reset').onclick = ()=>{ if(current) LEVELS[current].setup(scene); setResult(''); };
document.getElementById('resetProgress').onclick = ()=>{
  if(confirm('ç¡®å®šè¦æ¸…ç©ºé€šå…³è¿›åº¦å—ï¼Ÿ')){
    localStorage.removeItem('passedLevels');
    alert('è¿›åº¦å·²æ¸…ç©ºã€‚è¿”å›é¦–é¡µå¯çœ‹åˆ° 0/10ã€‚');
  }
};
nextBtn.onclick = ()=>{
  if(!current) return;
  const ids=Object.keys(LEVELS); const i=ids.indexOf(current);
  if(i>=0 && i<ids.length-1) openLevel(ids[i+1]); else setResult('ğŸ‰ å…¨éƒ¨é€šå…³ï¼', false);
};

// é»˜è®¤æ‰“å¼€ L1
openLevel('L1');
</script>
</body>
</html>

