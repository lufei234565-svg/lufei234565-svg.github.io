<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä»£ç æ¢é™©å²› Â· å…¨å…³å¡ (1â€“10)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --pri:#0078D7; --bg:#f5f7fa; --card:#fff; --border:#e5e7eb;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      --sans: "Microsoft YaHei", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:var(--sans);color:#111;min-height:100vh;display:flex;flex-direction:column}
    header{background:var(--pri);color:#fff;padding:16px 20px;text-align:center}
    .wrap{flex:1;display:flex;gap:12px;padding:12px;max-width:1200px;margin:0 auto;width:100%}
    .left{width:260px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px;height:calc(100vh - 120px);overflow:auto}
    .lvl{padding:10px 12px;border:1px solid var(--border);border-radius:10px;margin-bottom:8px;background:#fff;cursor:pointer}
    .lvl:hover{background:#f0f7ff}
    .right{flex:1;display:flex;flex-direction:column;gap:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    textarea{width:100%;height:240px;border:1px solid var(--border);border-radius:10px;padding:10px;font-family:var(--mono);font-size:14px;line-height:1.5}
    pre{background:#111;color:#0f0;border-radius:10px;padding:10px;min-height:140px;overflow:auto;white-space:pre-wrap}
    button{border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
    button.primary{background:var(--pri);border-color:var(--pri);color:#fff}
    #sandbox{min-height:32px}
    .meta{color:#555}
    .footer{padding:12px;text-align:center}
    a.back{color:var(--pri);text-decoration:none}
    a.back:hover{text-decoration:underline}
    @media (max-width:900px){ .wrap{flex-direction:column} .left{width:100%;height:auto} }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ ä»£ç æ¢é™©å²› Â· å…¨å…³å¡ (1â€“10)</h1>
  </header>

  <main class="wrap">
    <!-- å…³å¡åˆ—è¡¨ -->
    <aside class="left" id="list"></aside>

    <!-- å…³å¡å†…å®¹åŒº -->
    <section class="right">
      <div class="card">
        <h2 id="title">è¯·é€‰æ‹©å·¦ä¾§å…³å¡å¼€å§‹</h2>
        <p id="desc" class="meta">æç¤ºï¼šCtrl/Cmd + Enter è¿è¡Œï¼›æ¯å…³å³ä¾§ä¼šæ˜¾ç¤ºè¿è¡Œæ—¥å¿—ä¸æ˜¯å¦é€šå…³ã€‚</p>
      </div>

      <div class="card">
        <label for="editor" class="meta">ç¼–è¾‘ä»£ç </label>
        <textarea id="editor" placeholder="// é€‰æ‹©å…³å¡åï¼Œè¿™é‡Œä¼šå‡ºç°èµ·å§‹ä»£ç "></textarea>
        <div class="row">
          <button id="runBtn" class="primary">â–¶ è¿è¡Œä»£ç ï¼ˆCtrl/Cmd + Enterï¼‰</button>
          <button id="resetBtn">â†© æ¢å¤æ¨¡æ¿</button>
          <span id="status" class="meta"></span>
        </div>
      </div>

      <div class="card">
        <div class="row" style="align-items:center;justify-content:space-between">
          <strong>è¿è¡Œæ—¥å¿—</strong>
          <small class="meta">æ²™ç®±åŒºï¼ˆDOM ç›¸å…³å…³å¡ä¼šåœ¨æ­¤åˆ›å»ºå…ƒç´ ï¼‰</small>
        </div>
        <pre id="log">â€”</pre>
        <div id="sandbox"></div>
      </div>
    </section>
  </main>

  <div class="footer">
    <a class="back" href="../">â† è¿”å›é¦–é¡µ</a>
  </div>

<script>
/* ---------- å…³å¡æ•°æ® ---------- */
const LEVELS = {
  L1:{title:"L1 ç‚¹äº®ç«æŠŠ ğŸ”¥",desc:"ç”¨ console.log() è¾“å‡º Hello, Island!",
      starter:`console.log("Hello, Island!");`,
      eval({logs}){ return logs.some(s=>s.trim()==="Hello, Island!") ? ok("ç«æŠŠç‚¹äº®ï¼") : fail("æ²¡æ£€æµ‹åˆ° Hello, Island!"); }},

  L2:{title:"L2 ç§»åŠ¨å°çƒ âš½",desc:"è®© x=10ï¼Œå¹¶ submit(x)ã€‚",
      starter:`let x=0;\nx = x + 10;\nsubmit(x);`,
      eval({submitted}){ return submitted===10 ? ok("å°çƒå‰è¿› 10 æ­¥ï¼") : fail("æäº¤çš„ä¸æ˜¯ 10"); }},

  L3:{title:"L3 å¼€é—¨è¯•ç‚¼ ğŸšª",desc:"å½“ hasKey ä¸º true æ—¶ï¼Œè°ƒç”¨ openGate()ã€‚",
      starter:`let hasKey = true;\nif (hasKey) { openGate(); }`,
      eval({opened}){ return opened ? ok("å¤§é—¨æ‰“å¼€ï¼") : fail("æ²¡æœ‰è°ƒç”¨ openGate()"); }},

  L4:{title:"L4 é©¯æœå°æ€ªå…½ ğŸ²",desc:"ç”¨å¾ªç¯è¾“å‡º 3 æ¬¡ calm downã€‚",
      starter:`for (let i=0;i<3;i++) { console.log("calm down"); }`,
      eval({logs}){ const n=logs.filter(x=>x.trim()==="calm down").length; return n===3 ? ok("æ€ªå…½å¹³é™ï¼") : fail("æ£€æµ‹åˆ° "+n+" æ¬¡"); }},

  L5:{title:"L5 ç¯å¡”å¼•èˆª â›µ",desc:"è·¯çº¿ï¼šmove(5) â†’ turn('right') â†’ move(3)ã€‚",
      starter:`function plan(){\n  move(5);\n  turn("right");\n  move(3);\n}\nplan();`,
      eval({path}){ const ans=["move:5","turn:right","move:3"]; return JSON.stringify(path)===JSON.stringify(ans) ? ok("è·¯çº¿æ­£ç¡®ï¼") : fail("è·¯çº¿ä¸æ­£ç¡®"); }},

  L6:{title:"L6 å®ç®±å¯†ç  ğŸ’",desc:"è¾“å‡ºæ•°ç»„ gems ä¸‰ä¸ªå…ƒç´ ã€‚",
      starter:`let gems=["ruby","emerald","sapphire"];\nconsole.log(gems[0]);\nconsole.log(gems[1]);\nconsole.log(gems[2]);`,
      eval({logs}){ return JSON.stringify(logs)==='["ruby","emerald","sapphire"]' ? ok("å®ç®±è§£é”ï¼") : fail("è¾“å‡ºä¸æ­£ç¡®"); }},

  L7:{title:"L7 æ€ªå…½å›¾é‰´ ğŸ“–",desc:"åˆ›å»ºå¯¹è±¡ monsterï¼Œå¹¶è¾“å‡º name ä¸ levelã€‚",
      starter:`let monster={name:"Dragon",level:10};\nconsole.log(monster.name);\nconsole.log(monster.level);`,
      eval({logs}){ return logs.includes("Dragon") && logs.includes("10") ? ok("å›¾é‰´è§£é”ï¼") : fail("æ²¡æœ‰æ­£ç¡®è¾“å‡ºå±æ€§"); }},

  L8:{title:"L8 ç¥ç§˜çŸ³ç¢‘ ğŸ—¿",desc:"æŠŠ id=magicBtn çš„æŒ‰é’®æ–‡å­—æ”¹ä¸ºâ€œå·²æ¿€æ´»â€ã€‚",
      starter:`let btn=document.createElement("button");\nbtn.id="magicBtn";\nbtn.innerText="æŒ‰é’®";\ndocument.getElementById("sandbox").appendChild(btn);\nbtn.innerText="å·²æ¿€æ´»";`,
      eval({btn}){ return btn && btn.innerText==="å·²æ¿€æ´»" ? ok("çŸ³ç¢‘äº®èµ·ï¼") : fail("æ²¡æœ‰ä¿®æ”¹æŒ‰é’®æ–‡å­—"); }},

  L9:{title:"L9 é­”æ³•å·è½´ ğŸ“œ",desc:"ç»™æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»è¾“å‡º 'Spell Cast!'ã€‚",
      starter:`let btn=document.createElement("button");\nbtn.id="magicBtn";\nbtn.innerText="æŒ‰é’®";\ndocument.getElementById("sandbox").appendChild(btn);\nbtn.addEventListener("click",()=>console.log("Spell Cast!"));\nbtn.click();`,
      eval({logs}){ return logs.includes("Spell Cast!") ? ok("é­”æ³•é‡Šæ”¾ï¼") : fail("æ²¡æœ‰è¾“å‡º Spell Cast!"); }},

  L10:{title:"L10 ç»ˆæè¯•ç‚¼ ğŸ‘‘",desc:"æ•°ç»„ + å¯¹è±¡ + å¾ªç¯ï¼Œè¾“å‡ºæ€ªå…½ä¿¡æ¯ã€‚",
      starter:`let monsters=[{name:"Slime",hp:30},{name:"Orc",hp:50},{name:"Dragon",hp:100}];\nfor (let m of monsters){ console.log(m.name+" - HP: "+m.hp); }`,
      eval({logs}){ return ["Slime","Orc","Dragon"].every(n=>logs.some(x=>x.includes(n))) ? ok("ç»ˆæè¯•ç‚¼æˆåŠŸï¼") : fail("æ²¡æœ‰æ­£ç¡®è¾“å‡ºæ€ªå…½"); }},
};
const ORDER = Object.keys(LEVELS);

/* ---------- æ¸²æŸ“åˆ—è¡¨ ---------- */
const list = document.getElementById("list");
ORDER.forEach((id)=>{
  const d=document.createElement("div");
  d.className="lvl"; d.textContent=LEVELS[id].title;
  d.onclick=()=>openLevel(id);
  list.appendChild(d);
});

/* ---------- UIå¼•ç”¨ ---------- */
const titleEl=document.getElementById("title");
const descEl=document.getElementById("desc");
const editor=document.getElementById("editor");
const runBtn=document.getElementById("runBtn");
const resetBtn=document.getElementById("resetBtn");
const logEl=document.getElementById("log");
const sandbox=document.getElementById("sandbox");
const statusEl=document.getElementById("status");

let current=null;

/* ---------- æ‰“å¼€å…³å¡ ---------- */
function openLevel(id){
  current=id;
  titleEl.textContent=LEVELS[id].title;
  descEl.textContent=LEVELS[id].desc;
  editor.value=LEVELS[id].starter;
  statusEl.textContent="";
  logEl.textContent="â€”";
  sandbox.innerHTML="";
}

/* ---------- è¿è¡Œæ²™ç®± ---------- */
function runInSandbox(code){
  const logs=[];
  const safeConsole={ log:(...a)=>{ logs.push(a.join(" ")); } };
  let submitted, opened=false, path=[], btn=null;

  function submit(v){ submitted=v; }
  function openGate(){ opened=true; safeConsole.log("Gate opened"); }
  function move(s){ path.push("move:"+s); safeConsole.log("move "+s); }
  function turn(d){ path.push("turn:"+d); safeConsole.log("turn "+d); }

  // æ¯æ¬¡è¿è¡Œå‰æ¸…ç©ºæ²™ç®±åŒº
  sandbox.innerHTML="";

  try{
    // è®©ç”¨æˆ·ä»£ç èƒ½è®¿é—® sandboxï¼šdocument.getElementById("sandbox")
    const fn = new Function("console","submit","openGate","move","turn", code);
    fn(safeConsole, submit, openGate, move, turn);
  }catch(e){
    logs.push("ã€è¿è¡Œé”™è¯¯ã€‘"+e.message);
  }
  btn = document.getElementById("magicBtn");
  return {logs, submitted, opened, path, btn};
}
function ok(msg){ return {ok:true,msg}; }
function fail(msg){ return {ok:false,msg}; }

/* ---------- ç»‘å®šäº‹ä»¶ ---------- */
runBtn.onclick = () => {
  if(!current){ alert("è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©å…³å¡"); return; }
  const res = runInSandbox(editor.value);
  logEl.textContent = (res.logs.length?res.logs.join("\n"):"(æ— è¾“å‡º)");
  const judge = LEVELS[current].eval(res);
  statusEl.textContent = (judge.ok ? "âœ… " : "âŒ ") + judge.msg;
};
resetBtn.onclick = () => {
  if(!current) return;
  editor.value = LEVELS[current].starter;
  statusEl.textContent="å·²æ¢å¤æ¨¡æ¿";
  logEl.textContent="â€”";
  sandbox.innerHTML="";
};
window.addEventListener("keydown",(e)=>{
  if((e.ctrlKey||e.metaKey) && e.key==="Enter"){ runBtn.click(); }
});
</script>
</body>
</html>
